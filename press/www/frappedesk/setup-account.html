{%- extends "templates/saas_signup_layout.html" -%}

{%- block content -%}

<div class="mx-auto form-container col-xl-5 col-lg-6 col-md-7 col-sm-9" id="user-signup-verify">
	<button id="redirect" class="btn btn-primary" onclick="setup_account()" hidden>Redirect</button>
</div>

{%- endblock -%}

{%- block script -%}
<script src="/assets/press/js/form_controller.js"></script>
<script>
	let key = frappe.utils.get_url_arg('key');
	let btn = document.getElementById('redirect');

	function setup_account($form) {
		return call('press.api.saas.headless_setup_account', { key })
			.then(() => {
				window.location.href = '/prepare-site?key=' + key + '&app=frappedesk';
			});
	}

	function call(method, args, $form) {
		return frappe
			.call({
				method,
				args,
				type: "POST",
				btn: btn,
			})
			.then((r) => {
				if (r.exc) {
					console.error("An error occurred", r.exc);
					return;
				}
				return r;
			});
	}

	btn.click();

</script>
{%- endblock -%}
